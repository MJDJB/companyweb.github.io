<!DOCTYPE html>
<!-- 修改 lang 屬性為 en -->
<html lang="en">
<head>
    <meta charset="UTF - 8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.1/lunar.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <title>Tianji Metaphysics - BaZi & Cinnabar Energy Reading</title>
    <style>
        /* ===== 中国风弹出模态框 ===== */
.china-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(250, 240, 230, 0.9);
  z-index: 9999;
  display: none;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.5s ease-out;
}

.modal-content {
  text-align: center;
  max-width: 300px;
}

.bagua-wheel {
  position: relative;
  width: 150px;
  height: 150px;
  margin: 0 auto 25px;
}

.bagua-symbols {
  position: absolute;
  width: 100%;
  height: 100%;
  border: 3px solid var(--secondary);
  border-radius: 50%;
  animation: baguaRotate 10s linear infinite;
}

.bagua-symbols span {
  position: absolute;
  font-size: 24px;
  color: var(--primary);
}

/* 八卦符号定位 */
.bagua-symbols span:nth-child(1) { top: 0; left: 50%; transform: translateX(-50%) translateY(-50%); }
.bagua-symbols span:nth-child(2) { top: 25%; right: 15%; }
.bagua-symbols span:nth-child(3) { top: 50%; right: 0; transform: translateX(50%) translateY(-50%); }
.bagua-symbols span:nth-child(4) { bottom: 25%; right: 15%; }
.bagua-symbols span:nth-child(5) { bottom: 0; left: 50%; transform: translateX(-50%) translateY(50%); }
.bagua-symbols span:nth-child(6) { bottom: 25%; left: 15%; }
.bagua-symbols span:nth-child(7) { top: 50%; left: 0; transform: translateX(-50%) translateY(-50%); }
.bagua-symbols span:nth-child(8) { top: 25%; left: 15%; }

.taiji-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 60px;
  height: 60px;
}

.yin-yang {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: linear-gradient(to bottom, var(--primary) 50%, var(--bg) 50%);
  position: relative;
  animation: taijiPulse 2.5s ease infinite;
}

.yin-yang:before,
/* .yin-yang:after {
  content: '';
  position: absolute;
  width: 12px;
  height: 12px;
  border-radius: 50%;
} */

.yin-yang:before {
  background: var(--bg);
  top: 15px;
  left: 15px;
}

.yin-yang:after {
  background: var(--primary);
  bottom: 15px;
  right: 15px;
}

.loading-text .title {
  color: var(--primary);
  font-size: 1.3rem;
  font-weight: bold;
  margin-bottom: 5px;
}

.loading-text .subtitle {
  color: var(--text);
  font-size: 0.9rem;
  opacity: 0.8;
}

/* 动画定义 */
@keyframes baguaRotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes taijiPulse {
  0%, 100% { transform: translate(-50%, -50%) scale(1); }
  50% { transform: translate(-50%, -50%) scale(1.05); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

        :root {
            --primary: #8B0000; /* 硃砂紅 */
            --secondary: #DAA520; /* 金色 */
            --bg: #FAF0E6; /* 宣紙色 */
            --text: #5C3317; /* 墨色 */
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft JhengHei', '標楷體', serif;
        }
        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 2;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100" opacity="0.05"><text x="10" y="60" font-family="標楷體" font-size="18">天地玄黃 宇宙洪荒</text></svg>');
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 253, 245, 0.9);
            padding: 30px;
            border: 1px solid var(--secondary);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        .container:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100" opacity="0.03"><path d="M20,20 L80,20 L80,80 L20,80 Z" stroke="%238B0000" stroke-width="1"/></svg>');
            pointer-events: none;
            z-index: 0;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px double var(--primary);
            position: relative;
        }
        .yin-yang {
            width: 70px;
            height: 70px;
            margin: 0 auto 15px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="49" fill="%23333" stroke="%23DAA520" stroke-width="1"/><path d="M50,0 a50,50 0 0 1 0,100 25,25 0 0 0 0,-50 25,25 0 0 1 0,-50" fill="%23fff"/><circle cx="50" cy="25" r="8" fill="%23333"/><circle cx="50" cy="75" r="8" fill="%23fff"/></svg>') no-repeat center;
        }
        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            letter-spacing: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }
        @keyframes glow {
            0% { box-shadow: 0 0 10px var(--primary); }
            50% { box-shadow: 0 0 30px var(--primary); }
            100% { box-shadow: 0 0 10px var(--primary); }
        }
        .form-container, .result-container {
            animation: glow 3s infinite;
        }
        .form-container {
            padding: 30px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
            border: 1px solid var(--secondary);
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            color: var(--primary);
            font-weight: bold;
            font-size: 1.1rem;
        }
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--secondary);
            border-radius: 4px;
            font-size: 1rem;
            background: rgba(255, 248, 240, 0.8);
        }
        button {
            background: linear-gradient(to bottom, var(--primary), #6B0000);
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.1rem;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            letter-spacing: 2px;
            font-family: '標楷體';
        }
        button:hover {
            background: linear-gradient(to bottom, #6B0000, var(--primary));
        }
        .result-container {
            display: none;
            padding: 30px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
            border: 1px solid var(--secondary);
            animation: fadeIn 0.8s;
            position: relative;
            margin-top: 20px;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .destiny-type {
            font-size: 1.8rem;
            color: var(--primary);
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-top: 1px dashed var(--secondary);
            border-bottom: 1px dashed var(--secondary);
            font-weight: bold;
        }
        .bazi-display {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .bazi-pillar {
            font-size: 2.3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .wuxing-title {
            text-align: center;
            font-size: 1.3rem;
            color: var(--primary);
            margin: 25px 0 15px;
            position: relative;
        }
        .wuxing-title:before, .wuxing-title:after {
            content: "✧";
            color: var(--secondary);
            margin: 0 15px;
        }
        .wuxing-bars {
            margin: 30px 0;
        }
        .wuxing-bar {
            height: 20px;
            background: #F0F0F0;
            border-radius: 10px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        .wuxing-fill {
            height: 100%;
            position: absolute;
            transition: width 1s ease-out;
            text-align: right;
            padding-right: 5px;
            font-size: 0.8rem;
            line-height: 20px;
            color: white;
        }
        .wood { background: #2E8B57; }
        .fire { background: #DC143C; }
        .earth { background: #DAA520; }
        .metal { background: #4682B4; }
        .water { background: #4169E1; }
        .analysis-content {
            margin: 25px 0;
            line-height: 2;
        }
        .cinnabar-card {
            border: 1px dashed var(--secondary);
            padding: 25px;
            margin-top: 40px;
            text-align: center;
            position: relative;
            background: rgba(255, 248, 240, 0.7);
        }
        .cinnabar-card:before {
            content: "吉";
            position: absolute;
            top: 10px;
            right: 15px;
            color: var(--primary);
            opacity: 0.1;
            font-size: 6rem;
            z-index: 0;
            font-family: '標楷體';
        }
        .cinnabar-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }
        .cinnabar-name {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: bold;
        }
        .cinnabar-price {
            font-size: 1.5rem;
            color: var(--secondary);
            margin: 15px 0;
        }
        .cinnabar-benefits {
            text-align: left;
            margin: 20px 0;
            padding-left: 20px;
        }
        .cinnabar-benefits li {
            margin-bottom: 10px;
            position: relative;
            padding-left: 25px;
        }
        .cinnabar-benefits li:before {
            content: "✓";
            color: var(--secondary);
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        .btn-buy {
            display: inline-block;
            padding: 12px 30px;
            background: var(--secondary);
            color: #333;
            text-decoration: none;
            border-radius: 30px;
            margin-top: 15px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-buy:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(218, 165, 32, 0.3);
        }
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
                letter-spacing: 5px;
            }
            .bazi-pillar {
                font-size: 1.8rem;
            }
        }
        .challenge-options {
            display: grid;
            gap: 16px;
            grid-template-columns: 1fr 1fr;
            margin-top: 10px;
        }

        .option-card {
            border: 2px solid #ccc;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            gap: 12px;
            align-items: center;
            background: #fff;
        }

        .option-card .icon {
            font-size: 1.8em;
        }

        .option-card:hover {
            border-color: #d64c35;
            background: #fff5f1;
        }

        .option-card.selected {
            border-color: #d64c35;
            background: #fff0e9;
            box-shadow: 0 0 0 2px #d64c35 inset;
        }

        .option-card p {
            margin: 0;
            font-size: 0.9em;
            color: #555;
        }
/* ▼▼▼ 在这里插入优化代码 ▼▼▼ */
  .challenge-options {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }
  .option-card {
    min-height: 80px;
    padding: 15px;
  }
  @media (max-width: 480px) {
    .option-card {
      min-height: auto;
      padding: 12px;
    }
  }
  /* ▲▲▲ 插入结束 ▲▲▲ */
    /* 原有样式保持不变... */

    /* ▼▼▼ 添加日期输入框优化样式 ▼▼▼ */
    .date-input-container {
    position: relative;
}

.birthday-input {
    width: 100%;
    padding: 12px 15px;
    background: rgba(255, 248, 240, 0.8);
    border: 1px solid var(--secondary);
    border-radius: 4px;
    font-size: 1rem;
    color: var(--text);
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%238B0000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 15px center;
    background-size: 20px;
    padding-right: 40px;
}

/* 移除旧的日期输入框样式 */
#birthday {
    -webkit-appearance: none;
    min-height: 48px;
    padding: 12px 15px;
    color: var(--text);
    background: rgba(255, 248, 240, 0.8);
    font-family: Arial, sans-serif;
    /* 新增：为原生图标留出空间 */
    padding-right: 40px;
}

#birthday::-webkit-calendar-picker-indicator {
    opacity: 1; /* 恢复默认可见性 */
    position: relative; /* 取消绝对定位 */
    width: 20px; /* 固定宽度 */
    height: 20px; /* 固定高度 */
    padding: 0;
    margin: 0;
    cursor: pointer;
    /* 移除以下属性 */
    /* position: absolute; */
    /* width: 100%; */
    /* height: 100%; */
}

    #birthday::before {
        content: "Select your birth date (MM/DD/YYYY)";
        color: #888;
        position: absolute;
    }

    #birthday:focus::before,
    #birthday:valid::before {
        display: none;
    }

    @supports (-moz-appearance:none) {
        #birthday {
            background-image: none;
            padding-right: 15px;
        }
        #birthday:invalid {
            box-shadow: none;
        }
    }

    @media (max-width: 480px) {
        #birthday {
            font-size: 16px;
            padding: 15px;
            background-position: right 10px center;
        }
    }
    /* ▲▲▲ 日期输入框优化结束 ▲▲▲ */
    </style>
</head>
<body>

    <div class="container">
      <header>
        <div class="yin-yang"></div>
        <!-- Add Bagua Symbol -->
        <div class="bagua">
          <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 100 100">
            <!-- Simple Bagua Graphic -->
            <circle cx="50" cy="50" r="45" fill="#333" stroke="#DAA520" stroke-width="2" />
            <path d="M50,10 v30 M50,60 v30 M20,50 h30 M70,50 h30" stroke="#DAA520" stroke-width="4" />
          </svg>
        </div>
        <h1>Tianji Metaphysics</h1>
        <p>BaZi Destiny Reading · Elemental Balance · Empowering Cinnabar Charms</p>
      </header>
    
      <div class="form-container" id="form">
        <div class="metaphysics-intro">
          <p>
            BaZi (Eight Characters) is an ancient Chinese metaphysical system that reveals your life path through your
            birth date and time. It reflects how the Five Elements (Wood, Fire, Earth, Metal, Water) influence your destiny.
          </p>
        </div>
    
        <div class="form-group" id="first">
            <label for="birthday">Date of Birth</label>
            <!-- 替换原来的input type="date"为以下结构 -->
            <div class="date-input-container">
                <input type="text" id="birthday" class="birthday-input" placeholder="Select date" readonly>
                <input type="hidden" id="birthday-native" required>
            </div>
            <!-- <span class="date-format-hint">Format: MM/DD/YYYY</span> -->
        </div>
        
               
        <div class="form-group" id="second">
            <label for="birthtime">Birth Time</label>
            <select id="birthtime" required>
                <option value="">Select a time period</option>
                <option value="morning">Morning (5:00 AM – 12:59 PM)</option>
                <option value="afternoon">Afternoon (1:00 PM – 6:59 PM)</option>
                <option value="evening">Evening/Night (7:00 PM – 4:59 AM)</option>
            </select>
        </div>          
    
        <div class="form-group" id="third">
          <label for="gender">Gender</label>
          <select id="gender" required>
            <option value="">Select a gender</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="female">Other</option>
          </select>
        </div>

        <div class="form-group" id="step" style="display: none">
            <label>What’s your biggest challenge lately?</label>
            <div class="challenge-options" id="challenge-options">
            <div class="option-card" data-type="energy-booster">
                <div class="icon">🔋</div>
                <div class="text">
                <strong>Tired and unmotivated</strong>
                <p>You often feel drained, foggy, and stuck.</p>
                </div>
            </div>
            <div class="option-card" data-type="calm-balancer">
                <div class="icon">🌊</div>
                <div class="text">
                <strong>Anxious or emotionally unstable</strong>
                <p>Your thoughts race and your heart never rests.</p>
                </div>
            </div>
            <div class="option-card" data-type="action-igniter">
                <div class="icon">💭</div>
                <div class="text">
                <strong>Ideas but no action</strong>
                <p>You dream a lot but struggle to begin.</p>
                </div>
            </div>
            <div class="option-card" data-type="grounding-protector">
                <div class="icon">🔥</div>
                <div class="text">
                <strong>Short-tempered or overwhelmed</strong>
                <p>You react quickly and burn out even faster.</p>
                </div>
            </div>
            </div>
        </div>
    
        <button id="calculateBtn">✦ Begin My Reading ✦</button>
        <button id="nextBtn" style="display: none">✦ Next ✦</button>
      </div>
      <div class="result-container" id="result">
        <div class="destiny-type" id="destiny-type">Your Energy Type</div>
    
        <div class="bazi-display">
          <div>
            <div class="bazi-pillar" id="year-pillar"></div>
            <div>Year Pillar (Ancestry)</div>
          </div>
          <div>
            <div class="bazi-pillar" id="month-pillar"></div>
            <div>Month Pillar (Parents)</div>
          </div>
          <div>
            <div class="bazi-pillar" id="day-pillar"></div>
            <div>Day Pillar (Self)</div>
          </div>
          <div>
            <div class="bazi-pillar" id="hour-pillar"></div>
            <div>Hour Pillar (Children)</div>
          </div>
        </div>
    
        <div class="wuxing-title">Your Five Element Energy Distribution</div>
        <div class="wuxing-bars">
          <div class="wuxing-bar">
            <div class="wuxing-fill wood" id="wood-bar" style="width: 0%">Wood</div>
          </div>
          <div class="wuxing-bar">
            <div class="wuxing-fill fire" id="fire-bar" style="width: 0%">Fire</div>
          </div>
          <div class="wuxing-bar">
            <div class="wuxing-fill earth" id="earth-bar" style="width: 0%">Earth</div>
          </div>
          <div class="wuxing-bar">
            <div class="wuxing-fill metal" id="metal-bar" style="width: 0%">Metal</div>
          </div>
          <div class="wuxing-bar">
            <div class="wuxing-fill water" id="water-bar" style="width: 0%">Water</div>
          </div>
        </div>
    
        <div class="analysis-content" id="fortune-analysis">
          <!-- Energy analysis will appear here -->
        </div>
    
        <div class="cinnabar-card">
          <div class="cinnabar-icon" id="cinnabar-icon">🔴</div>
          <h3 class="cinnabar-name" id="cinnabar-name">Recommended Cinnabar Talisman</h3>
          <p>Crafted based on your elemental profile</p>
          <div class="cinnabar-price" id="cinnabar-price">$27.00</div>
          <ul class="cinnabar-benefits" id="cinnabar-benefits">
            <!-- Product benefits will appear here -->
          </ul>
          <div class="btn-description">
    <p style="font-size: 1.1em; color: #e74c3c; margin-bottom: 15px;">✨ Tap into ancient Chinese mysticism</p>
    <p style="margin-bottom: 20px;">Click the button to explore our authentic cinnabar bracelets —<br>each one chosen to align with your spirit.</p>
</div>
<a href="http://baidu.com.cn" class="btn-buy" id="buy-button">Order Now</a>
<div class="youtube-shop" style="margin-top: 20px;">
    <p>Or browse our <a href="http://youtube.com/@chinesematchmaker" style="color: #3498db; text-decoration: underline;">YouTube shop</a> for a piece that speaks to your soul.</p>
</div>
          <p style="margin-top: 15px; font-size: 0.9em;" id="limited-counter">Limited to <span id="remaining-count">150</span> pieces</p>
        </div>
    
        <button id="returnBtn">✦ Go Back ✦</button>
      </div>
    </div>
    
    <script>
        //日期校验
    // 设置动态日期范围（添加在脚本最前面）
    document.addEventListener('DOMContentLoaded', function() {
    // 动态限量计算
    function updateRemainingCount() {
        const userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const now = new Date();
        
        // 转换为欧美主要时区时间
        const options = { timeZone: userTimeZone, hour12: false };
        const localTime = now.toLocaleString('en-US', options);
        
        // 计算当日已过分钟数
        const startOfDay = new Date(localTime);
        startOfDay.setHours(0,0,0,0);
        const diffMs = now - startOfDay;
        const tenMinuteIntervals = Math.floor(diffMs / 600000);

        // 计算剩余数量（150为基准，每分钟减少1）
        let remaining = 150 - tenMinuteIntervals;
        remaining = remaining > 0 ? remaining : 1;

        // 更新显示
        document.getElementById('remaining-count').textContent = remaining;
    }

    // 初始更新并设置定时器
    updateRemainingCount();
    setInterval(updateRemainingCount, 60000); // 每分钟检查一次
        const today = new Date();
        const dd = String(today.getDate()).padStart(2, '0');
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const yyyy = today.getFullYear();
        
        document.getElementById('birthday').max = `${yyyy}-${mm}-${dd}`;
        
        // 设置默认值为30年前
        const defaultDate = new Date();
        defaultDate.setFullYear(yyyy - 30);
        document.getElementById('birthday').valueAsDate = defaultDate;
    });
// 在DOMContentLoaded事件监听器内添加
document.addEventListener('DOMContentLoaded', function() {
    // 原有的日期范围设置
    const today = new Date();
    const dd = String(today.getDate()).padStart(2, '0');
    const mm = String(today.getDate()).padStart(2, '0');
    const yyyy = today.getFullYear();
    
    // 初始化Flatpickr
    flatpickr("#birthday", {
        dateFormat: "Y-m-d",
        minDate: "1900-01-01",
        maxDate: today,
        defaultDate: new Date(yyyy - 30, today.getMonth(), today.getDate()),
        onChange: function(selectedDates, dateStr) {
            document.getElementById('birthday-native').value = dateStr;
        }
    });

    // 原有的其他代码保持不变
});
document.getElementById('calculateBtn').addEventListener('click', () => {
    // 改为使用birthday-native的值
    birthday = new Date(document.getElementById('birthday').value);
    birthtime = document.getElementById('birthtime').value;
    gender = document.getElementById('gender').value;
    
    // 分字段验证逻辑
    if (!birthday) {
        alert('Please select your birth date');
        document.getElementById('birthday').focus();
        return;
    }
    
    if (!birthtime) {
        alert('Please choose your birth time');
        document.getElementById('birthtime').parentElement.scrollIntoView();
        return;
    }
    
    if (!gender) {
        alert('Please select your gender');
        document.getElementById('gender').parentElement.style.backgroundColor = '#fff3cd';
        setTimeout(() => {
            document.getElementById('gender').parentElement.style.backgroundColor = '';
        }, 2000);
        return;
    }
    document.getElementById('first').style.display = 'none';
    document.getElementById('second').style.display = 'none';
    document.getElementById('third').style.display = 'none';
    document.getElementById('step').style.display = 'block';
    document.getElementById('calculateBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'block';
});

    // 原有脚本内容保持不变...

        // ====== 中國傳統命理數據庫 ======
        const DESTINY_DATA = {
            // 五行對應關係
            elements: {
                wood: { name: "木", color: "#2E8B57", score: 0 },
                fire: { name: "火", color: "#DC143C", score: 0 },
                earth: { name: "土", color: "#DAA520", score: 0 },
                metal: { name: "金", color: "#4682B4", score: 0 },
                water: { name: "水", color: "#4169E1", score: 0 }
            },
            // 八字神煞
            auspiciousSigns: {
                "天乙貴人": "危難時刻有貴人相助",
                "文昌貴人": "聰明過人，學業事業有成",
                "太極貴人": "悟性極高，適合修行參道",
                "天月德貴人": "一生少災厄，逢凶化吉"
            },
            // 命理類型分析
            destinyTypes: [
                {
                    name: "木火通明格",
                    desc: "您命帶木火相生之氣，具有創造力與行動力，但需注意水火平衡",
                    weakElement: "water",
                    advice: "多親近水環境可調和命中火氣"
                },
                {
                    name: "金白水清格",
                    desc: "金水相生賦予您聰明才智，但需補足土氣以穩定運勢",
                    weakElement: "earth",
                    advice: "佩戴黃色硃砂可增強土行能量"
                },
                {
                    name: "土厚金埋格",
                    desc: "穩重踏實是您的優勢，但需木氣疏土以釋放潛能",
                    weakElement: "wood",
                    advice: "綠色植物與木質擺件可激活運勢"
                },
                {
                    name: "水火既濟格",
                    desc: "水火平衡，運勢平和，需保持各元素的均衡"
                }
            ],
            types: [
                {
                    id: "energy-booster",
                    name: "Energy Booster",
                    trait: "Low Fire and Earth energy",
                    personality:
                    "Easily fatigued, mentally foggy, struggles with motivation and long-term planning.",
                    zodiac: "Emotionally driven like Water signs (Pisces, Cancer, Scorpio)",
                    explanation:
                    "Your birth energy shows a deficiency in Fire and Earth elements, which are responsible for drive, structure, and grounded action. You may often feel drained, indecisive, or stuck in your thoughts. Strengthening your inner fire is key to reigniting your passion and reclaiming direction.",
                    product: {
                    name: "Red Cinnabar Power Bracelet",
                    material: "Natural Red Cinnabar + Energized Red Agate Beads",
                    price: "$17.77",
                    benefits: [
                        "Revives inner energy flow within 7 days",
                        "Improves motivation and decision clarity",
                        "Traditionally worn by generals and Taoist priests for protection and courage",
                        "Red agate helps anchor thoughts into action",
                        "Cleansed & charged during full moon rituals"
                    ],
                    icon: "🔥",
                    callToAction: "Activate Your Fire Energy",
                    badge: "Best for burnout, fatigue & emotional fog"
                    }
                },
                {
                    id: "calm-balancer",
                    name: "Calm Balancer",
                    trait: "Excess Water and Metal energy",
                    personality:
                    "Highly sensitive, anxious, prone to overthinking and insomnia. Emotionally reactive and easily overwhelmed.",
                    zodiac: "Like Air signs with emotional depth (Gemini, Libra, Aquarius)",
                    explanation:
                    "Your chart reveals overactive Water and Metal elements. This causes emotional turbulence, difficulty sleeping, and mental over-processing. You absorb energy from others too easily, and need grounding tools to stabilize your emotions.",
                    product: {
                    name: "Cinnabar & Obsidian Peace Pendant",
                    material: "Polished Black Obsidian + Red Cinnabar Core",
                    price: "$28.88",
                    benefits: [
                        "Shields your aura from negative emotional energy",
                        "Promotes inner peace and deeper sleep",
                        "Balances the heart-mind connection",
                        "Cinnabar calms nervous energy and overactivity",
                        "Obsidian clears absorbed emotional toxins"
                    ],
                    icon: "💧",
                    callToAction: "Find My Inner Balance",
                    badge: "Best for anxiety, emotional empaths & deep sleepers"
                    }
                },
                {
                    id: "action-igniter",
                    name: "Action Igniter",
                    trait: "Strong Wood, deficient Fire",
                    personality:
                    "Creative thinker, full of ideas but lacks follow-through. Easily distracted, struggles with self-discipline.",
                    zodiac: "Like Fire signs in shadow (Leo, Aries, Sagittarius)",
                    explanation:
                    "You have strong generative (Wood) energy, but weak transformation (Fire) energy. This means you're constantly inspired, but rarely able to convert plans into results. Restoring your inner fire is crucial for execution and forward motion.",
                    product: {
                    name: "Cinnabar & Brass Focus Beads",
                    material: "Real Cinnabar, Antiqued Brass + Action Sigils",
                    price: "$32.22",
                    benefits: [
                        "Ignites your execution power and decisiveness",
                        "Channels mental energy into physical action",
                        "Worn by entrepreneurs for clarity and momentum",
                        "Brass amplifies solar (yang) fire intention",
                        "Cinnabar protects against mental self-sabotage"
                    ],
                    icon: "⚡",
                    callToAction: "Boost My Action Energy",
                    badge: "Best for creatives, procrastinators & overthinkers"
                    }
                },
                {
                    id: "grounding-protector",
                    name: "Grounding Protector",
                    trait: "Excess Fire and Earth energy",
                    personality:
                    "Irritable, quick-tempered, often feels mentally overloaded or spiritually agitated. Tends to burn out quickly.",
                    zodiac: "Fiery and dominant like Aries, Taurus, or Capricorn",
                    explanation:
                    "You possess powerful Fire and Earth energy — but in excess, it can cause emotional volatility, short temper, and energetic blockages. You need purification and clarity to protect your spiritual space and calm inner heat.",
                    product: {
                    name: "White Quartz & Cinnabar Protection Ring",
                    material: "Polished White Quartz + Sacred Cinnabar Core",
                    price: "$27.00",
                    benefits: [
                        "Reduces irritability and restores mental calm",
                        "Blocks toxic emotional energies and overexertion",
                        "Enhances spiritual clarity and self-composure",
                        "White Quartz purifies fire overflows and mental static",
                        "Cinnabar provides grounding in high-pressure environments"
                    ],
                    icon: "🌍",
                    callToAction: "Restore My Inner Peace",
                    badge: "Best for overworked minds & emotional protection"
                    }
                }
            ],
            destinytypes: [
                {
                    name: "Energy Booster (Fire/Earth Deficient)",
                    desc: "Your energy analysis shows a lack of Fire/Earth elements. This causes low motivation and indecisiveness.",
                    product: {
                        id: "energy-bracelet",
                        name: "Red Cinnabar Bracelet",
                        price: "\$17.77",
                        icon: "🔥",
                        benefits: [
                        "Boost vitality & confidence",
                        "Ancient Chinese energy talisman",
                        "Handcrafted with pure cinnabar"
                        ],
                        urgencyMsg: "23 people bought this today"
                    }
                },
                {
                    name: "Energy Booster (Fire/Earth Deficient)",
                    desc: "Your energy analysis shows a lack of Fire/Earth elements. This causes low motivation and indecisiveness.",
                    product: {
                        id: "energy-bracelet",
                        name: "Red Cinnabar Bracelet",
                        price: "\$17.77",
                        icon: "🔥",
                        benefits: [
                        "Boost vitality & confidence",
                        "Ancient Chinese energy talisman",
                        "Handcrafted with pure cinnabar"
                        ],
                        urgencyMsg: "23 people bought this today"
                    }
                },
                {
                    name: "Energy Booster (Fire/Earth Deficient)",
                    desc: "Your energy analysis shows a lack of Fire/Earth elements. This causes low motivation and indecisiveness.",
                    product: {
                        id: "energy-bracelet",
                        name: "Red Cinnabar Bracelet",
                        price: "\$17.77",
                        icon: "🔥",
                        benefits: [
                        "Boost vitality & confidence",
                        "Ancient Chinese energy talisman",
                        "Handcrafted with pure cinnabar"
                        ],
                        urgencyMsg: "23 people bought this today"
                    }
                },
                {
                    name: "Energy Booster (Fire/Earth Deficient)",
                    desc: "Your energy analysis shows a lack of Fire/Earth elements. This causes low motivation and indecisiveness.",
                    product: {
                        id: "energy-bracelet",
                        name: "Red Cinnabar Bracelet",
                        price: "\$17.77",
                        icon: "🔥",
                        benefits: [
                        "Boost vitality & confidence",
                        "Ancient Chinese energy talisman",
                        "Handcrafted with pure cinnabar"
                        ],
                        urgencyMsg: "23 people bought this today"
                    }
                }
            ]
        };
        // 獲取表單元素
        const form = document.querySelector('.form-container form');
        const birthdayInput = document.getElementById('birthday');
        const birthtimeInput = document.getElementById('birthtime');
        const genderInput = document.getElementById('gender');
        const resultContainer = document.getElementById('result');
        const formContainer = document.getElementById('form');
        let selectedTypeId = null;
        let birthday = null;
        let birthtime = null;
        let gender = null;
        // 計算按鈕點擊事件
        // document.getElementById('calculateBtnB').addEventListener('click', () => {
        //     // 簡單驗證
        //     if (!birthdayInput.value || !birthtimeInput.value || !genderInput.value) {
        //         alert('請填寫所有必填字段');
        //         return;
        //     }
        //     // 模擬命理計算
        //     const randomType = DESTINY_DATA.destinyTypes[Math.floor(Math.random() * DESTINY_DATA.destinyTypes.length)];
        //     // 顯示結果
        //     document.getElementById('destiny-type').textContent = randomType.name;
        //     document.getElementById('fortune-analysis').textContent = randomType.desc;
        //     resultContainer.style.display = 'block';
        //     formContainer.style.display = 'none';
        // });
        // 返回按鈕點擊事件
        document.getElementById('returnBtn').addEventListener('click', () => {
            resultContainer.style.display = 'none';
            formContainer.style.display = 'block';
            document.getElementById('first').style.display = 'block';
            document.getElementById('second').style.display = 'block';
            document.getElementById('third').style.display = 'block';
            document.getElementById('step').style.display = 'none';
            document.getElementById('calculateBtn').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';
        });
        
        // 在<script>标签内替换为以下代码
        // document.getElementById('calculateBtn').addEventListener('click', () => {
        //     birthday = new Date(document.getElementById('birthday').value);
        //     birthtime = new Date(document.getElementById('birthtime').value);
        //     gender = document.getElementById('gender').value;
            
        //     if (!birthday || !gender || !birthtime) {
        //         alert('Please fill all fields');
        //         return;
        //     }
        //     document.getElementById('first').style.display = 'none';
        //     document.getElementById('second').style.display = 'none';
        //     document.getElementById('third').style.display = 'none';
        //     document.getElementById('step').style.display = 'block';
        //     document.getElementById('calculateBtn').style.display = 'none';
        //     document.getElementById('nextBtn').style.display = 'block';
        // });

        document.querySelectorAll(".option-card").forEach(card => {
            card.addEventListener("click", () => {
            // 清除已有选中状态
            document.querySelectorAll(".option-card").forEach(c => c.classList.remove("selected"));
            // 添加选中状态
            card.classList.add("selected");
            // 保存选中的类型ID
            selectedTypeId = card.getAttribute("data-type");
            });
        });

       document.getElementById("nextBtn").addEventListener("click", function() {
  if (!selectedTypeId) {
    alert("Please select the option that best describes you.");
    return;
  }

  // 显示中国风弹出层
  const modal = document.getElementById('china-modal');
  modal.style.display = 'flex';
  
  // 禁用页面滚动
  document.body.style.overflow = 'hidden';

  // 2秒后自动关闭并继续流程
  setTimeout(function() {
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
    
    // 执行原有计算逻辑
    const destinyType = calculateDestinyType(birthday, gender, selectedTypeId);
    showResult(destinyType);
    
  }, 2000); // 2秒后自动关闭
});


        // 五行能量计算函数
        function calculateWood(year, month, selectedTypeId, birthtime) {
            let value = (month >= 1 && month <= 3 ? 40 : 15) + (year % 10) * 2 + 20;

            if (selectedTypeId === 'energy-booster') value += 5;
            if (selectedTypeId === 'grounding-protector') value -= 5;

            if (birthtime === 'morning') value += 5;
            if (birthtime === 'evening') value -= 3;

            return Math.max(10, value);
        }

        function calculateFire(month, day, selectedTypeId, birthtime) {
            let value = (month >= 4 && month <= 6 ? 50 : 20) + (day % 30) * 1.2;

            if (selectedTypeId === 'energy-booster') value += 10;
            if (selectedTypeId === 'action-igniter') value += 8;
            if (selectedTypeId === 'grounding-protector') value -= 10;

            if (birthtime === 'morning') value += 6;
            if (birthtime === 'evening') value -= 6;

            return Math.max(10, value);
        }

        function calculateEarth(year, day, selectedTypeId, birthtime) {
            const isSeasonEnd = [3, 6, 9, 12].includes(new Date(year, 0, 1).getMonth() + 1);
            let value = (isSeasonEnd ? 45 : 30) + (year % 12) * 1.5 + (day % 6) * 4;

            if (selectedTypeId === 'grounding-protector') value += 8;
            if (selectedTypeId === 'calm-balancer') value += 5;

            if (birthtime === 'afternoon') value += 5;

            return Math.max(10, value);
        }

        function calculateMetal(year, month, selectedTypeId, birthtime) {
            let value = (month >= 7 && month <= 9 ? 55 : 25) + ((year % 5) + 1) * 5;

            if (selectedTypeId === 'calm-balancer') value += 10;

            if (birthtime === 'afternoon') value += 4;
            if (birthtime === 'evening') value += 5;

            return Math.max(10, value);
        }

        function calculateWater(month, day, selectedTypeId, birthtime) {
            const inWinter = (month >= 10 || month === 1);
            let value = (inWinter ? 60 : 35) + (30 - day) * 0.8;

            if (selectedTypeId === 'calm-balancer') value += 8;
            if (selectedTypeId === 'action-igniter') value -= 5;
            if (selectedTypeId === 'grounding-protector') value -= 3;

            if (birthtime === 'evening') value += 6;
            if (birthtime === 'morning') value -= 3;

            return Math.max(10, value);
        }

        // 命理类型判定算法
        function determineType(elements, gender, selectedTypeId = null, birthtime = null) {
            const types = DESTINY_DATA.types;

            // 用户已手动选择心境类型，直接返回
            if (selectedTypeId && types.some(type => type.id === selectedTypeId)) {
                return types.find(type => type.id === selectedTypeId);
            }

            const scores = {
                wood: elements.wood,
                fire: elements.fire,
                earth: elements.earth,
                metal: elements.metal,
                water: elements.water
            };

            // 性别微调（阳刚/阴柔属性）
            const genderModifier = gender === 'male' ? 1.2 : 0.8;
            scores.fire *= genderModifier;
            scores.water /= genderModifier;

            // ➕ 出生时间影响五行倾向（阴阳影响）
            if (birthtime === 'morning') {
                scores.fire += 5;
                scores.wood += 5;
            } else if (birthtime === 'afternoon') {
                scores.earth += 5; // 平衡之时，增强中土
            } else if (birthtime === 'evening') {
                scores.water += 6;
                scores.metal += 4;
                scores.fire -= 4; // 晚上火衰
            }

            // 命理推理逻辑
            if (scores.fire < 50 && scores.earth < 50) {
                return types.find(type => type.id === "energy-booster");
            } else if (scores.metal > 70 && scores.water > 70) {
                return types.find(type => type.id === "calm-balancer");
            } else if (scores.wood > 65 && scores.fire < 60) {
                return types.find(type => type.id === "action-igniter");
            } else {
                return types.find(type => type.id === "grounding-protector");
            }
        }

        // 结果展示函数// Enhanced result rendering function
        function showResult(type) {
            // 基本信息展示
            document.getElementById('destiny-type').textContent = type.name;

            // 分析部分构建
            document.getElementById('fortune-analysis').innerHTML = `
                <p><strong>🔮 Type Explanation:</strong><br> ${type.explanation}</p>
                <p><strong>🧠 Personality Traits:</strong> ${type.personality}</p>
                <p><strong>♻️ Elemental Insight:</strong> ${type.trait}</p>
                <p><strong>✨ Compatible Zodiac:</strong> ${type.zodiac}</p>
            `;

            // 产品部分构建
            const product = type.product;

            document.getElementById('cinnabar-icon').textContent = product.icon;
            document.getElementById('cinnabar-name').textContent = product.name;
            document.getElementById('cinnabar-price').textContent = product.price;

            // 加入 badge 标签（如“Best for anxiety”等）
            const badgeHTML = product.badge
                ? `<div class="product-badge">⭐ ${product.badge}</div>`
                : '';

            // 展示好处列表
            const benefitsList = product.benefits.map(
                (b) => `<li>🔸 ${b}</li>`
            ).join('');

            document.getElementById('cinnabar-benefits').innerHTML = `
                ${badgeHTML}
                <ul class="benefit-list">${benefitsList}</ul>
            `;

            // CTA 按钮文字更新
            const ctaButton = document.getElementById('cta-button');
            if (ctaButton) {
                ctaButton.textContent = product.callToAction || 'Learn More';
                ctaButton.style.display = 'inline-block';
            }

            // 显示/隐藏界面
            document.getElementById('result').style.display = 'block';
            document.getElementById('form').style.display = 'none';

            // 可选：滚动到结果位置
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }

        // function showResult(type) {
        //     document.getElementById('destiny-type').textContent = type.name;
        //     document.getElementById('fortune-analysis').innerHTML = `
        //         <p><strong>Personality:</strong> ${type.personality}</p>
        //         <p><strong>Compatible Zodiac:</strong> ${type.zodiac}</p>
        //         <p><strong>Elemental Insight:</strong> ${type.trait}</p>
        //     `;

        //     // 更新产品推荐
        //     const product = type.product;
        //     document.getElementById('cinnabar-icon').textContent = product.icon;
        //     document.getElementById('cinnabar-name').textContent = product.name;
        //     document.getElementById('cinnabar-price').textContent = product.price;
            
        //     const benefitsList = product.benefits.map(b => `<li>${b}</li>`).join('');
        //     document.getElementById('cinnabar-benefits').innerHTML = benefitsList;
            
        //     // 显示结果页
        //     document.getElementById('result').style.display = 'block';
        //     document.getElementById('form').style.display = 'none';
        // }
        function calculateDestinyType(birthDate, gender, selectedTypeId) {
            debugger;
            // 1. 将生日转换为农历年份（简化版）
            let year = birthDate.getFullYear();
            let month = birthDate.getMonth() + 1;
            let day = birthDate.getDate();
            debugger;
            try {
                // const result = solarlunar.solar2lunar(year, month, day);
                const solar = Solar.fromYmd(year, month, day);
                const lunar = solar.getLunar();
                year = lunar.getYear(); // 农历年份
                month = lunar.getMonth(); // 农历月份
                day = lunar.getDay(); // 农历日期
                console.log(year+month+day)
            } catch (error) {
                alert('Invalid date format. Please try again.');
            }
            // 2. 计算五行能量值（0-100）
            const elements = {
                wood: calculateWood(year, month, selectedTypeId),
                fire: calculateFire(month, day, selectedTypeId),
                earth: calculateEarth(year, day, selectedTypeId),
                metal: calculateMetal(year, month, selectedTypeId),
                water: calculateWater(month, day, selectedTypeId)
            };
            const woodBar = document.getElementById('wood-bar');
            const waterBar = document.getElementById('water-bar');
            const metalBar = document.getElementById('metal-bar');
            const earthBar = document.getElementById('earth-bar');
            const fireBar = document.getElementById('fire-bar');
            woodBar.style.width = elements.wood + '%';
            waterBar.style.width = elements.water + '%';
            metalBar.style.width = elements.metal + '%';
            earthBar.style.width = elements.earth + '%';
            fireBar.style.width = elements.fire + '%';
        
            // 3. 根据五行相生相克确定命理类型
            return determineType(elements, gender);
        }
    </script>
    <!-- 中国风弹出式过渡层 -->
<div id="china-modal" class="china-modal">
    <div class="modal-content">
      <!-- 八卦旋转盘 -->
      <div class="bagua-wheel">
        <div class="bagua-symbols">
          <span>☰</span><span>☱</span><span>☲</span><span>☳</span>
          <span>☴</span><span>☵</span><span>☶</span><span>☷</span>
        </div>
        <!-- 太极中心 -->
        <div class="taiji-center">
          <div class="yin-yang"></div>
        </div>
      </div>
      <!-- 文字说明 -->
      <div class="loading-text">
        <p class="title">天机推演中...</p>
        <p class="subtitle">八卦轮转 · 阴阳相生 · 命理显现</p>
      </div>
    </div>
  </div>
  
</body>
</html>
